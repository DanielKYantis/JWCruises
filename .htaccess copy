<IfModule mod_rewrite.c>
  RewriteEngine On

  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

  RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s(?:/)?(index|index\.php|index\.html|home|home\.php)[\s?] [NC]
  RewriteRule ^(index|home)(?:\.php|\.html)?$ / [L,R=301]

  RewriteRule ^$ - [E=CACHE_HTML:1]

  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.php -f
  RewriteRule ^(.+)$ $1.php [L,QSA]

  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.html -f
  RewriteRule ^(.+)$ $1.html [L,QSA]
</IfModule>

DirectoryIndex home.php

Options +MultiViews
#Enables content negotiation “MultiViews.” If a client requests /foo and no file exactly named foo exists, Apache will look for files like foo.html, foo.php, foo.en.html, etc., and serve the best match based on the client’s language and file-type preferences.

Options +FollowSymlinks
#Allows Apache to follow symbolic links (symlinks) in the filesystem. Without this, if your site contains a symlink pointing somewhere else, Apache would refuse to serve it.

Options -Indexes
#If a directory doesn’t contain any of the default index files (like index.html or index.php), this tells Apache to generate and display a file-listing of that directory. Without +Indexes, you’d normally get a “403 Forbidden” instead.

#IndexIgnore */*
#When directory-listing is enabled (via +Indexes), this tells Apache to hide all files and subdirectories in the listing. You’ll still get the blank “index” view (so you know the directory exists) but nothing inside will be shown.

#AddDefaultCharset utf-8
#ServerSignature Off

AddType application/manifest+json .webmanifest .json
AddType application/javascript .js

<IfModule mod_headers.c>
  Header always set Cache-Control "public, max-age=60" env=CACHE_HTML

  #Header unset ETag
  #Header unset X-Powered-By
  #Header always unset X-Powered-By

  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
  #Header set X-XSS-Protection "1"

  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  Header set Timing-Allow-Origin: "*"
  Header set Access-Control-Allow-Methods: "GET"
  Header set Access-Control-Allow-Origin: "*"
  Header append Vary Origin
  Header set Cross-Origin-Embedder-Policy "require-corp"
  Header set Cross-Origin-Opener-Policy "same-origin-allow-popups"
  Header set Cross-Origin-Resource-Policy "cross-origin"

  Header set Permissions-Policy "autoplay=(),camera=(),display-capture=(),encrypted-media=(),fullscreen=(self),geolocation=(),microphone=(),payment=(),picture-in-picture=(),publickey-credentials-get=(),screen-wake-lock=(),sync-xhr=(self),web-share=()"

  #Header set Content-Security-Policy-Report-Only "upgrade-insecure-requests; require-trusted-types-for 'script';"

  Header always set Reporting-Endpoints "csp=\"https://jwcruises.com/csp-report-endpoint.php\""
  Header always set Report-To "{\"group\":\"csp\",\"max_age\":10886400,\"endpoints\":[{\"url\":\"https://jwcruises.com/csp-report-endpoint.php\"}],\"include_subdomains\":true}"

  Header set Content-Security-Policy-Report-Only "default-src 'self'; base-uri 'self'; form-action 'self'; style-src 'self' 'unsafe-inline' *.googleapis.com; script-src 'self' 'unsafe-inline' *.google.com *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com; connect-src 'self' *.google.com *.google-analytics.com *.googletagmanager.com *.googleapis.com *.gstatic.com cdnjs.cloudflare.com code.jquery.com cdn.jsdelivr.net; img-src https: data: blob: https://www.google-analytics.com; object-src 'none'; frame-ancestors 'self'; manifest-src 'self'; worker-src 'self'; report-to csp; report-uri https://jwcruises.com/csp-report-endpoint.php"

  <FilesMatch "\.(js|css|png|jpg|jpeg|gif|webp|svg|woff|woff2|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  <FilesMatch "^(sw\.js|service-worker\.js)$">
    Header set Cache-Control "no-store"
  </FilesMatch>

  <FilesMatch "\.(html|php)$">
    Header set Cache-Control "public, max-age=300"
  </FilesMatch>

  <FilesMatch "(^#.*#|\.(htm|html|php)|~)$">
    Header set X-UA-Compatible "IE=Edge,chrome=1"
  </FilesMatch>
</IfModule>

<FilesMatch "(^#.*#|\.(htaccess|htpasswd|bak|conf|dist|fla|in[ci]|log|orig|psd|sh|sql|sw[op])|~)$">
  Require all denied
</FilesMatch>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE image/svg+xml image/x-icon
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject application/x-font-ttf font/opentype
  AddOutputFilterByType DEFLATE application/javascript application/x-javascript text/javascript text/x-js
  AddOutputFilterByType DEFLATE text/html text/plain text/richtext text/css application/json text/xsd text/xsl
  AddOutputFilterByType DEFLATE text/xml text/x-component application/xml application/xhtml+xml application/rss+xml application/atom+xml
  <IfModule mod_setenvif.c>
    SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
    RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
  </IfModule>
</IfModule>

ErrorDocument 404 /404.php?error=404
